subroutine twobody_potential(S,r0,mass,rho,theta,phi,V)

  use constants
  
  implicit none

  !.. Input
  real(kind(1.d0)), intent(in)    :: S,r0,mass(3),rho,theta,phi
  real(kind(1.d0)), intent(inout) :: V

  !.. Local
  !.. r(1)=r23, r(2)=r31, r(3)=r12
  real(kind(1.0d0)) :: r(3), d(3), redmass, totmass, channelangle(3)

  !.. External functions/variables
  real(kind(1.d0)) :: potential(3)

  totmass = mass(1)+mass(2)+mass(3)
  redmass = (mass(1)*mass(2)*mass(3)/totmass)**0.5d0
  d = ((mass/redmass)*(1.d0-(mass/totmass)))**0.5d0
  channelangle(1) = 0.d0
  channelangle(2) = -2.d0*atan(mass(3)/redmass)
  channelangle(3) = 2.d0*atan(mass(2)/redmass)
  
  r = d*rho*((sqrt(2.d0)**(-0.5d0)))*(1.d0+sin(theta)*cos(phi+channelangle))**0.5d0

  !  r(3) = (3.d0**(-0.25d0))*rho*(1.d0+cos(2.d0*theta)*cos(2.d0*phi))**0.5d0
  !  r(1) = (3.d0**(-0.25d0))*rho*(1.d0+cos(2.d0*theta)*cos(2.d0*phi+2.d0*Pi/3.d0))**0.5d0
  !  r(2) = (3.d0**(-0.25d0))*rho*(1.d0+cos(2.d0*theta)*cos(2.d0*phi-2.d0*Pi/3.d0))**0.5d0
  ! r(3) = (3.d0**(-0.25))*rho*(1.d0+sin(theta)*sin(phi-Pi/6.d0))**0.5d0
  ! r(1) = (3.d0**(-0.25))*rho*(1.d0+sin(theta)*sin(phi-5.d0*Pi/6.d0))**0.5d0
  ! r(2) = (3.d0**(-0.25))*rho*(1.d0+sin(theta)*sin(phi+Pi/2.d0))**0.5d0
  call model_potential(S,r0,r,potential)
 

  
  V = sum(potential)
  
  return

end subroutine twobody_potential
  
